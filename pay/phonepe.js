"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}!function(w){if(w){var now=Date.now(),cssClassNames={phonepeFadein:"phonepeFadein"+ ++now,phonepeBottomToTop:"phonepeBottomToTop"+ ++now,_phonepeSDK:"_phonepeSDK"+ ++now,frameWrap:"frameWrap"+ ++now,frame:"frame"+ ++now,transparentiframe:"transparentiframe"+ ++now,mobile:"mobile"+ ++now,prefetchFrame:"frame"+ ++now,hide:"hide"+ ++now,hidden:"hidden"+ ++now},tokenUrls=[],constants={allowedOrigins:["https://mercury-stg.phonepe.com","https://mercury-uat.phonepe.com"],Errors:{UNRECOGNISED_MESSAGE:"Unrecognised request!",CALLBACK_NOT_FUNCTION:"Callback should be a proper JS function!",TOKEN_URL_REPEATED:"Token URL should be unique each time!"},bridges:{BACK_TO_MERCHANT_CHECKOUT_JS:"BACK_TO_MERCHANT_CHECKOUT_JS",MAKE_IFRAME_TRANSPARENT:"MAKE_IFRAME_TRANSPARENT"},Keys:{ESCAPE:27},merchantCallback:void 0,metaCache:{viewPort:"width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no",viewPortBackup:void 0}};w.addEventListener("message",function(event){var origin=event.origin,data=event.data;event.source;if(-1!==constants.allowedOrigins.indexOf(origin)&&data){var _ref=function(data){try{var _data=data="string"==typeof data?JSON.parse(atob(data)):data,bridgeContext=_data.bridgeContext,bridgeBody=_data.bridgeBody,bridgeError=_data.bridgeError,context="string"==typeof bridgeContext?JSON.parse(bridgeContext):bridgeContext;if(!context.bridgeType)return;return{context:context,body:"string"==typeof bridgeBody?JSON.parse(bridgeBody)||{}:bridgeBody,error:bridgeError?JSON.parse(bridgeError):void 0}}catch(e){return{}}}(data)||{},context=_ref.context;if(_ref.body,_ref.error,context)switch(context.bridgeType){case constants.bridges.BACK_TO_MERCHANT_CHECKOUT_JS:var code=context.code;constants.merchantCallback(code),Utils.editParentMeta(!0),Utils.frame.closeFrame();break;case constants.bridges.MAKE_IFRAME_TRANSPARENT:var isTransparent=context.isTransparent;Utils.frame.makeIFrameTransparent(isTransparent)}}});var Utils={styles:"\n        @-webkit-keyframes "+cssClassNames.phonepeFadein+" {\n          from {\n            opacity: 0;\n          }\n          to {\n            opacity: 1;\n          }\n        }\n        @-o-keyframes "+cssClassNames.phonepeFadein+" {\n          from {\n            opacity: 0;\n          }\n          to {\n            opacity: 1;\n          }\n        }\n        @-webkit-keyframes "+cssClassNames.phonepeBottomToTop+" {\n          from {\n            bottom: -120%;\n          }\n          to {\n            bottom: 0;\n          }\n        }\n        @-o-keyframes "+cssClassNames.phonepeBottomToTop+" {\n          from {\n            bottom: -120%;\n          }\n          to {\n            bottom: 0;\n          }\n        }\n\n        ."+cssClassNames._phonepeSDK+"."+cssClassNames.frameWrap+"  {\n          height:100%;\n          width:100%;\n          position:fixed;\n          left:0;\n          top:0;\n          border:none;\n          background: rgba(0,0,0,0.4);\n          z-index:2147000000;\n          animation: 500ms "+cssClassNames.phonepeFadein+";\n        }\n        ."+cssClassNames._phonepeSDK+" ."+cssClassNames.prefetchFrame+", \n        ."+cssClassNames._phonepeSDK+"."+cssClassNames.frameWrap+"."+cssClassNames.hide+" {\n          display: none;\n        }\n\n        ."+cssClassNames._phonepeSDK+" ."+cssClassNames.frame+" {\n          height: 100%;\n          max-height: 640px;\n          z-index: 2147000000;\n          max-width: 360px;\n          border: none;\n          position: fixed;\n          width: 100%;\n          left: 50%;\n          top: 50%;\n          transform: translate(-50%, -50%);\n          box-shadow: 3px 3px 25px -3px rgba(0,0,0,0.45);\n          border-radius: 10px;\n        }\n        ."+cssClassNames._phonepeSDK+" ."+cssClassNames.frame+"."+cssClassNames.mobile+" {\n          left: 0;\n          top: auto;\n          bottom: 0;\n          max-height: 564px;\n          max-width: 420px;\n          transform: translateY(0);\n          background-color: white;\n          animation: 280ms "+cssClassNames.phonepeBottomToTop+";\n          border-radius: 10px 10px 0 0;\n        }\n        ."+cssClassNames._phonepeSDK+" ."+cssClassNames.frame+"."+cssClassNames.mobile+"."+cssClassNames.transparentiframe+" {\n          max-height: 190px;\n          background-color: transparent;\n        }\n        ."+cssClassNames.hidden+" {\n          display: none;\n        }\n\t\t",editParentMeta:function(reset){try{reset?document.querySelector('meta[name="viewport"]').setAttribute("content",constants.metaCache.viewPortBackup):(constants.metaCache.viewPortBackup=document.querySelector('meta[name="viewport"]').content,document.querySelector('meta[name="viewport"]').setAttribute("content",constants.metaCache.viewPort))}catch(e){}},appendStyle:function(_ref2){_ref2.url;var css=_ref2.css;if(css){document.createElement("style");var head=document.head||document.getElementsByTagName("head")[0],style=document.createElement("style");head.appendChild(style),style.type="text/css",style.styleSheet?style.styleSheet.cssText=css:style.appendChild(document.createTextNode(css))}},dlScript:function(e,t){var n=void 0,a=document.createElement("script");a.async=!0,a.defer=!0,a.setAttribute("src",e),t&&(a.onreadystatechange=a.onload=function(){n||t(),n=!0}),document.getElementsByTagName("head")[0].appendChild(a)},frame:{instanceWrapper:null,instance:null,instanceID:"phonepe-transact-"+Date.now(),prefetchInstance:null,prefetchID:"phonepe-preload-"+Date.now(),prefetch:"https://mercury-stg.phonepe.com/transact/prefetch",setFullScreen:function(){if(this.instanceWrapper){var isMobile=window&&window.screen&&window.screen.width<=600;this.instanceWrapper.className=cssClassNames._phonepeSDK+" "+cssClassNames.frameWrap,this.instance.className=cssClassNames.frame+" "+(isMobile?cssClassNames.mobile:"")}},updateBottomPosition:function(sBottomPosition){var frame=this.instance;window&&window.screen&&window.screen.width<=600&&(frame.style.bottom=sBottomPosition)},createFrame:function(src,id){var sandbox=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).sandbox,iframe=document.createElement("iframe");return iframe.id=iframe.name=id+"-frame",iframe.src=src,iframe.referrerpolicy="no-referrer",iframe.referrer=document.referrer,iframe.sandbox=sandbox||"",iframe.setAttribute("allowtransparency",!0),iframe.setAttribute("allow","payment"),iframe},create:function(src,id){var _this=this,sandbox=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).sandbox;this.instanceWrapper||function(){var instanceWrapper=document.createElement("div");instanceWrapper.id=id,instanceWrapper.className=cssClassNames._phonepeSDK+" "+cssClassNames.frameWrap+" "+cssClassNames.hide,_this.instanceWrapper=instanceWrapper}();var instanceWrapper=this.instanceWrapper,frame=this.createFrame(src,id,{sandbox:sandbox});return instanceWrapper.appendChild(frame),this.instance=frame,document.body.appendChild(instanceWrapper),frame},closeFrame:function(){var frame=this.instance;this.instanceWrapper.className=""+cssClassNames.hidden,this.instanceWrapper.removeChild(frame),this.unbindDOMEvents(),this.instance=void 0,constants.merchantCallback=void 0},makeIFrameTransparent:function(isTransparent){var frame=this.instance,currentClasses=frame.className;if(isTransparent){if(currentClasses.includes(""+cssClassNames.transparentiframe))return;frame.className=currentClasses+" "+cssClassNames.transparentiframe}else{var activeClass=currentClasses.replace(""+cssClassNames.transparentiframe,"");frame.className=activeClass}},createPrefetch:function(){this.prefetchInstance=this.create(this.prefetch,this.prefetchID),this.prefetchInstance.className=cssClassNames.prefetchFrame},createTransact:function(tokenUrl){return this.instance=this.create(tokenUrl,this.instanceID,{sandbox:"allow-scripts allow-top-navigation allow-same-origin allow-forms allow-popups"}),this.bindDOMEvents(),this.instance},onKeyUp:function(e){},bindDOMEvents:function(){},unbindDOMEvents:function(){},init:function(){this.createPrefetch(),Utils.appendStyle({css:Utils.styles})}}},Checkout=function(){function Checkout(){_classCallCheck(this,Checkout)}return _createClass(Checkout,[{key:"transact",value:function(_ref5){var tokenUrl=_ref5.tokenUrl,callback=_ref5.callback,bottomPosition=_ref5.bottomPosition;if(tokenUrl){if(-1!==tokenUrls.indexOf(tokenUrl))throw new Error(constants.Errors.TOKEN_URL_REPEATED);if("function"!=typeof callback)throw new Error("Exception :: ",constants.Errors.CALLBACK_NOT_FUNCTION);Utils.editParentMeta(),tokenUrls.push(tokenUrl);var finalTokenUrl=""+tokenUrl+(-1===tokenUrl.indexOf("?")?"?":"&")+"iframe=true";this.tokenUrl=Utils.frame.tokenUrl=finalTokenUrl,Utils.frame.createTransact(tokenUrl),Utils.frame.setFullScreen(),constants.merchantCallback=callback,bottomPosition&&Utils.frame.updateBottomPosition(bottomPosition)}}}]),Checkout}();Utils.frame.init();var t=new Checkout;w.PhonePe=t}}(void 0!==("undefined"==typeof window?"undefined":_typeof(window))&&window);